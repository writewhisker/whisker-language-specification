# Stage 1.06: TypeScript - Error Codes Definition

## Objective
Create the unified error codes definition file for TypeScript.

## Files to Create
- `packages/story-validation/src/error-codes/wls-error-codes.ts`
- `packages/story-validation/src/error-codes/index.ts`

## Prompt

```
Create error codes files in the whisker-editor-web repository:

1. Create directory and files:
/Users/jims/code/github.com/writewhisker/whisker-editor-web/packages/story-validation/src/error-codes/wls-error-codes.ts
/Users/jims/code/github.com/writewhisker/whisker-editor-web/packages/story-validation/src/error-codes/index.ts

2. In wls-error-codes.ts, define:

export type ErrorSeverity = 'error' | 'warning' | 'info';

export interface WLSErrorDefinition {
  id: string;
  severity: ErrorSeverity;
  message: string;
  category: 'STR' | 'LNK' | 'VAR' | 'EXP' | 'TYP' | 'FLW' | 'QUA';
}

export const WLS_ERROR_CODES: Record<string, WLSErrorDefinition> = {
  // Structure
  'WLS-STR-001': { id: 'missing_start_passage', severity: 'error', message: "Story must have a 'Start' passage", category: 'STR' },
  'WLS-STR-002': { id: 'unreachable_passage', severity: 'warning', message: "Passage '%s' is not reachable from Start", category: 'STR' },
  'WLS-STR-003': { id: 'duplicate_passage', severity: 'error', message: "Duplicate passage name '%s'", category: 'STR' },
  'WLS-STR-004': { id: 'empty_passage', severity: 'warning', message: "Passage '%s' has no content", category: 'STR' },
  'WLS-STR-005': { id: 'orphan_passage', severity: 'info', message: "Passage '%s' has no incoming links", category: 'STR' },
  'WLS-STR-006': { id: 'bottleneck_passage', severity: 'info', message: "All paths pass through '%s'", category: 'STR' },

  // Links
  'WLS-LNK-001': { id: 'dead_link', severity: 'error', message: "Link to undefined passage '%s'", category: 'LNK' },
  'WLS-LNK-002': { id: 'self_link', severity: 'warning', message: "Passage '%s' links to itself", category: 'LNK' },
  'WLS-LNK-003': { id: 'special_target_case', severity: 'warning', message: "Special target '%s' should be '%s'", category: 'LNK' },
  'WLS-LNK-004': { id: 'empty_choice_target', severity: 'error', message: "Choice has no target passage", category: 'LNK' },
  'WLS-LNK-005': { id: 'circular_link_chain', severity: 'info', message: "Circular link chain detected: %s", category: 'LNK' },

  // Variables (continue pattern for all 8)
  // Expressions (all 7)
  // Types (all 5)
  // Flow (all 6)
  // Quality (all 5)
};

// Helper function
export function formatErrorMessage(code: string, ...args: string[]): string {
  const def = WLS_ERROR_CODES[code];
  if (!def) return `Unknown error: ${code}`;
  let msg = def.message;
  args.forEach(arg => { msg = msg.replace('%s', arg); });
  return msg;
}

export function getErrorSeverity(code: string): ErrorSeverity {
  return WLS_ERROR_CODES[code]?.severity ?? 'error';
}

3. In index.ts, re-export everything:
export * from './wls-error-codes';

4. Update packages/story-validation/src/index.ts to export the new module:
Add: export * from './error-codes';
```

## Expected Output
~200 lines in wls-error-codes.ts with all 42 error codes defined.

## Verification
```bash
cd ~/code/github.com/writewhisker/whisker-editor-web

# Check file exists
ls packages/story-validation/src/error-codes/

# Count error codes
grep -c "WLS-" packages/story-validation/src/error-codes/wls-error-codes.ts
# Expected: 42+

# Type check
pnpm --filter @writewhisker/story-validation typecheck
```

## Next Stage
1.07-ts-validation-types.md
