# Stage 1.13: TypeScript - Validator Index and Registration

## Objective
Update the validator index to export and register all new validators.

## Files to Modify
- `packages/story-validation/src/validators/index.ts`
- `packages/story-validation/src/defaultValidator.ts`

## Prompt

```
Update validator registration in whisker-editor-web:

1. Update packages/story-validation/src/validators/index.ts:

// Existing exports
export { MissingStartPassageValidator } from './MissingStartPassageValidator';
export { DeadLinksValidator } from './DeadLinksValidator';
export { UnreachablePassagesValidator } from './UnreachablePassagesValidator';
export { UndefinedVariablesValidator } from './UndefinedVariablesValidator';
export { UnusedVariablesValidator } from './UnusedVariablesValidator';
export { EmptyPassagesValidator } from './EmptyPassagesValidator';

// New validators
export { DuplicatePassagesValidator } from './DuplicatePassagesValidator';
export { SelfLinkValidator } from './SelfLinkValidator';
export { DeadEndValidator } from './DeadEndValidator';
export { CycleDetectorValidator } from './CycleDetectorValidator';

// Re-export types
export type { StoryValidator, WLSValidationError, ValidationResult } from '../types';

2. Update packages/story-validation/src/defaultValidator.ts:

import {
  MissingStartPassageValidator,
  DeadLinksValidator,
  UnreachablePassagesValidator,
  UndefinedVariablesValidator,
  UnusedVariablesValidator,
  EmptyPassagesValidator,
  DuplicatePassagesValidator,
  SelfLinkValidator,
  DeadEndValidator,
  CycleDetectorValidator,
} from './validators';
import type { StoryValidator, ValidationResult } from './types';
import type { Story } from '@writewhisker/story-models';

const DEFAULT_VALIDATORS: StoryValidator[] = [
  // Structure validators (run first)
  new MissingStartPassageValidator(),
  new DuplicatePassagesValidator(),
  new EmptyPassagesValidator(),
  new UnreachablePassagesValidator(),

  // Link validators
  new DeadLinksValidator(),
  new SelfLinkValidator(),

  // Variable validators
  new UndefinedVariablesValidator(),
  new UnusedVariablesValidator(),

  // Flow validators
  new DeadEndValidator(),
  new CycleDetectorValidator(),
];

export function createDefaultValidator() {
  return {
    validate(story: Story): ValidationResult {
      const errors: WLSValidationError[] = [];
      const warnings: WLSValidationError[] = [];
      const info: WLSValidationError[] = [];

      for (const validator of DEFAULT_VALIDATORS) {
        const results = validator.validate(story);
        for (const result of results) {
          switch (result.severity) {
            case 'error':
              errors.push(result);
              break;
            case 'warning':
              warnings.push(result);
              break;
            case 'info':
              info.push(result);
              break;
          }
        }
      }

      return {
        valid: errors.length === 0,
        errors,
        warnings,
        info,
      };
    },
  };
}

3. Ensure all imports resolve and no circular dependencies.
```

## Expected Output
~80 lines updated across two files.

## Verification
```bash
cd ~/code/github.com/writewhisker/whisker-editor-web

# Type check
pnpm --filter @writewhisker/story-validation typecheck

# Run all tests
pnpm --filter @writewhisker/story-validation test -- --run

# Build succeeds
pnpm --filter @writewhisker/story-validation build
```

## Next Stage
1.14-lua-error-codes.md
