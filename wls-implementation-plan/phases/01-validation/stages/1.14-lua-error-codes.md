# Stage 1.14: Lua - Error Codes Definition

## Objective
Create the unified error codes definition file for Lua.

## Files to Create
- `lib/whisker/validators/error_codes.lua`

## Prompt

```
Create the error codes file in whisker-core:
/Users/jims/code/github.com/writewhisker/whisker-core/lib/whisker/validators/error_codes.lua

Create directory if needed: lib/whisker/validators/

Define all WLS error codes matching the TypeScript implementation:

local M = {}

M.SEVERITY = {
  ERROR = "error",
  WARNING = "warning",
  INFO = "info"
}

M.CODES = {
  -- Structure
  ["WLS-STR-001"] = { id = "missing_start_passage", severity = M.SEVERITY.ERROR, message = "Story must have a 'Start' passage", category = "STR" },
  ["WLS-STR-002"] = { id = "unreachable_passage", severity = M.SEVERITY.WARNING, message = "Passage '%s' is not reachable from Start", category = "STR" },
  ["WLS-STR-003"] = { id = "duplicate_passage", severity = M.SEVERITY.ERROR, message = "Duplicate passage name '%s'", category = "STR" },
  ["WLS-STR-004"] = { id = "empty_passage", severity = M.SEVERITY.WARNING, message = "Passage '%s' has no content", category = "STR" },
  ["WLS-STR-005"] = { id = "orphan_passage", severity = M.SEVERITY.INFO, message = "Passage '%s' has no incoming links", category = "STR" },
  ["WLS-STR-006"] = { id = "bottleneck_passage", severity = M.SEVERITY.INFO, message = "All paths pass through '%s'", category = "STR" },

  -- Links
  ["WLS-LNK-001"] = { id = "dead_link", severity = M.SEVERITY.ERROR, message = "Link to undefined passage '%s'", category = "LNK" },
  ["WLS-LNK-002"] = { id = "self_link", severity = M.SEVERITY.WARNING, message = "Passage '%s' links to itself", category = "LNK" },
  ["WLS-LNK-003"] = { id = "special_target_case", severity = M.SEVERITY.WARNING, message = "Special target '%s' should be '%s'", category = "LNK" },
  ["WLS-LNK-004"] = { id = "empty_choice_target", severity = M.SEVERITY.ERROR, message = "Choice has no target passage", category = "LNK" },
  ["WLS-LNK-005"] = { id = "circular_link_chain", severity = M.SEVERITY.INFO, message = "Circular link chain detected: %s", category = "LNK" },

  -- Variables (all 8)
  ["WLS-VAR-001"] = { id = "undefined_variable", severity = M.SEVERITY.ERROR, message = "Variable '%s' is used but never defined", category = "VAR" },
  ["WLS-VAR-002"] = { id = "unused_variable", severity = M.SEVERITY.WARNING, message = "Variable '%s' is defined but never used", category = "VAR" },
  -- ... continue for all VAR codes

  -- Expressions (all 7)
  -- Types (all 5)
  -- Flow (all 6)
  -- Quality (all 5)
}

-- Helper: format error message with arguments
function M.format_message(code, ...)
  local def = M.CODES[code]
  if not def then return "Unknown error: " .. code end
  local args = {...}
  local msg = def.message
  for _, arg in ipairs(args) do
    msg = msg:gsub("%%s", tostring(arg), 1)
  end
  return msg
end

-- Helper: get severity
function M.get_severity(code)
  local def = M.CODES[code]
  return def and def.severity or M.SEVERITY.ERROR
end

-- Helper: create error object
function M.create_error(code, location, ...)
  local def = M.CODES[code]
  return {
    code = code,
    id = def and def.id or "unknown",
    severity = def and def.severity or M.SEVERITY.ERROR,
    message = M.format_message(code, ...),
    location = location or {}
  }
end

return M

Include ALL 42 error codes defined in the specification.
```

## Expected Output
~200 lines Lua file with all error codes.

## Verification
```bash
cd ~/code/github.com/writewhisker/whisker-core

# File exists
ls lib/whisker/validators/error_codes.lua

# Count codes
grep -c "WLS-" lib/whisker/validators/error_codes.lua
# Expected: 42+

# Lua syntax check
luac -p lib/whisker/validators/error_codes.lua
```

## Next Stage
1.15-lua-validator-init.md
