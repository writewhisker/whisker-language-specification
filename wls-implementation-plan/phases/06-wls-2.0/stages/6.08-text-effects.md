# Stage 6.08: Text Effects and Transitions

## Objective
Implement dynamic text presentation effects.

## Files to Create
- `packages/story-player/src/TextEffects.ts`
- `packages/player-ui/src/effects/`

## Prompt

```
Create text effects system:

1. Specification:

## Text Effects (WLS 2.0)

Dynamic text presentation.

### Transitions

```whisker
@transition: fade-in 1s
The scene changes...

@transition: slide-left 0.5s
A new location appears.
```

### Text Effects

```whisker
@effect: typewriter 50ms {
The message appears letter by letter.
}

@effect: shake 500ms {
BOOM!
}

@effect: pulse {
Important text
}

@effect: glitch {
C̷o̵r̴r̷u̷p̸t̵e̶d̸
}
```

### Custom CSS

```whisker
@style: my-effect {
  animation: custom-animation 1s;
}
```

2. TypeScript implementation:

interface TextEffect {
  name: string;
  apply(element: HTMLElement, options: EffectOptions): void;
  duration?: number;
}

export class TextEffectManager {
  private effects: Map<string, TextEffect> = new Map();

  constructor() {
    this.registerBuiltins();
  }

  private registerBuiltins(): void {
    this.effects.set('typewriter', {
      name: 'typewriter',
      apply: (el, opts) => {
        const text = el.textContent || '';
        el.textContent = '';
        let i = 0;
        const interval = setInterval(() => {
          el.textContent += text[i++];
          if (i >= text.length) clearInterval(interval);
        }, opts.speed || 50);
      }
    });

    this.effects.set('shake', {
      name: 'shake',
      apply: (el, opts) => {
        el.style.animation = \`shake \${opts.duration || 500}ms\`;
      }
    });

    this.effects.set('fade-in', {
      name: 'fade-in',
      apply: (el, opts) => {
        el.style.opacity = '0';
        el.style.transition = \`opacity \${opts.duration || 1000}ms\`;
        requestAnimationFrame(() => {
          el.style.opacity = '1';
        });
      }
    });
  }

  applyEffect(element: HTMLElement, effectName: string, options: EffectOptions): void {
    const effect = this.effects.get(effectName);
    if (effect) {
      effect.apply(element, options);
    }
  }

  registerCustom(name: string, effect: TextEffect): void {
    this.effects.set(name, effect);
  }
}

// CSS for built-in effects
const EFFECT_CSS = \`
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}
\`;

3. Parser updates for @effect and @transition.
```

## Expected Output
~150 lines TypeScript.

## Verification
```bash
pnpm --filter @writewhisker/player-ui test -- --run effects
```

## Next Stage
6.09-parameterized-passages.md
