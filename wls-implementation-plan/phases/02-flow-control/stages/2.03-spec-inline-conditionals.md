# Stage 2.03: Specification - Inline Conditionals and Once-Only

## Objective
Add inline conditionals and once-only text to the specification.

## Files to Modify
- `phase-1-specification/spec/02-FLOW-CONTROL.md`

## Prompt

```
Update the flow control specification to add:

## Inline Conditionals

Conditional text within a single line.

### Syntax

```
{condition ? true_text | false_text}
```

### Examples

```whisker
:: Shop
You have {$gold > 100 ? "plenty of" | "only a few"} coins.
The merchant {$visited ? "recognizes you" | "eyes you suspiciously"}.
```

### In Choices

```whisker
+ [Buy sword] {$gold >= 50 ? "" | "(Need 50 gold)"} -> BuySword
```

### Nested

```whisker
{$rank > 5 ? {$rank > 10 ? "elite" | "veteran"} | "rookie"} status
```

### Rules

1. Both branches required (use empty string for no output)
2. Condition uses same expression syntax as blocks
3. Can be nested (limit: 3 levels recommended)
4. Works in content, choices, and passage names (interpolation)

---

## Once-Only Text

Text that displays only on first visit.

### Syntax

```whisker
{once}
First-time content here.
{/once}
```

### Example

```whisker
:: Room
{once}
You enter the dusty room for the first time.
{/once}
The room is dark and musty.
```

First visit: Both paragraphs display
Subsequent: Only "The room is dark and musty."

### Tracking

- Tracked by passage name + block position
- Persists across save/load
- Reset with `{do whisker.resetOnce("Room")}`

### Multiple Blocks

```whisker
:: Guide
{once}
"Welcome, stranger!"
{/once}
{once}
"Let me explain the rules."
{/once}
"How can I help?"
```

First visit: All three
Second: Only "How can I help?"

### With Conditions

```whisker
{once}
{$hasKey}
You notice the door has a keyhole.
{/}
{/once}
```

### Rules

1. Once blocks can contain any content including choices
2. Nested once blocks are independent
3. Empty once block: valid, acts as "has visited" flag
```

## Expected Output
~100 lines added to specification.

## Verification
```bash
grep -c "once\|inline" phase-1-specification/spec/02-FLOW-CONTROL.md
```

## Next Stage
2.04-ts-parser-gather.md
