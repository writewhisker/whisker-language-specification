# Stage 2.06: TypeScript - Parser Inline Conditionals

## Objective
Add inline conditional parsing to TypeScript parser.

## Files to Modify
- `packages/parser/src/whisker.pegjs`
- `packages/story-models/src/types.ts`

## Prompt

```
Update the TypeScript parser to support inline conditionals:

1. Update packages/story-models/src/types.ts:

export interface InlineConditionalNode {
  type: 'inline_conditional';
  condition: ExpressionNode;
  trueContent: ContentNode[];
  falseContent: ContentNode[];
  line: number;
}

// This goes inside text content
// "You have {$x > 5 ? many | few} items"

2. Update packages/parser/src/whisker.pegjs:

// Inline conditional in text
InlineConditional
  = "{" _ condition:Expression _ "?" _ trueContent:InlineText _ "|" _ falseContent:InlineText _ "}" {
      return {
        type: 'inline_conditional',
        condition: condition,
        trueContent: trueContent,
        falseContent: falseContent,
        line: location().start.line
      };
    }

// Inline text (no newlines, can contain nested inline conditionals)
InlineText
  = parts:(InlineConditional / InlinePlainText)* {
      return parts;
    }

InlinePlainText
  = chars:$([^{}|]+) {
      return { type: 'text', value: chars };
    }

// Update text parsing to recognize inline conditionals
TextContent
  = parts:(InlineConditional / VariableInterpolation / PlainText)+ {
      return { type: 'text_content', parts: parts };
    }

3. Create tests:

describe('Inline Conditionals', () => {
  it('parses simple inline conditional', () => {
    const story = parse(\`
:: Start
You have {$gold > 100 ? plenty of | only a few} coins.
\`);
    // Verify inline conditional in text
  });

  it('parses nested inline conditionals', () => {
    const story = parse(\`
:: Start
Status: {$rank > 5 ? {$rank > 10 ? elite | veteran} | rookie}
\`);
    // Verify nested structure
  });

  it('parses inline conditional in choice', () => {
    const story = parse(\`
:: Start
+ [Buy {$gold >= 50 ? "" | "(need gold)"}] -> Shop
\`);
  });

  it('handles empty branches', () => {
    const story = parse(\`
:: Start
{$debug ? [DEBUG MODE] | }
\`);
  });
});
```

## Expected Output
~30 lines types + ~50 lines grammar + ~60 lines tests.

## Verification
```bash
cd ~/code/github.com/writewhisker/whisker-editor-web

pnpm --filter @writewhisker/parser test -- --run inline
```

## Next Stage
2.07-ts-parser-once.md
