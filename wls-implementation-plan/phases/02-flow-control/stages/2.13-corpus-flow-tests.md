# Stage 2.13: Test Corpus - Flow Control Tests

## Objective
Create comprehensive test corpus for flow control features.

## Files to Create
- `phase-4-validation/test-corpus/flow-control/gather-tests.yaml`
- `phase-4-validation/test-corpus/flow-control/tunnel-tests.yaml`
- `phase-4-validation/test-corpus/flow-control/once-tests.yaml`

## Prompt

```
Create flow control test corpus:

1. Create phase-4-validation/test-corpus/flow-control/gather-tests.yaml:

- name: gather-simple
  description: Simple gather after choices
  input: |
    :: Start
    + [A] You chose A.
    + [B] You chose B.
    -
    After choice.
  play:
    - choose: 0
      output_contains: ["You chose A.", "After choice."]

- name: gather-nested
  description: Nested gather points
  input: |
    :: Start
    + [Outer]
      ++ [Inner A] Inner A.
      ++ [Inner B] Inner B.
      --
      After inner.
    -
    After outer.
  play:
    - choose: 0
    - choose: 0
      output_contains: ["Inner A.", "After inner.", "After outer."]

- name: gather-multiple
  description: Multiple sequential gathers
  input: |
    :: Start
    + [A] A
    -
    Between.
    + [B] B
    -
    End.
  play:
    - choose: 0
      output_contains: ["A", "Between."]
    - choose: 0
      output_contains: ["B", "End."]

- name: gather-with-content
  description: Gather with inline content
  input: |
    :: Start
    + [A] A
    + [B] B
    - The story continues here.
  play:
    - choose: 0
      output_contains: "The story continues here."

2. Create phase-4-validation/test-corpus/flow-control/tunnel-tests.yaml:

- name: tunnel-simple
  description: Basic tunnel call and return
  input: |
    :: Start
    Before.
    -> Aside ->
    After.

    :: Aside
    In aside.
    ->->
  play:
    - output_sequence: ["Before.", "In aside.", "After."]

- name: tunnel-nested
  description: Nested tunnel calls
  input: |
    :: Start
    -> A ->
    Done.

    :: A
    In A.
    -> B ->
    Back in A.
    ->->

    :: B
    In B.
    ->->
  play:
    - output_sequence: ["In A.", "In B.", "Back in A.", "Done."]

- name: tunnel-with-choice
  description: Tunnel returns from choice
  input: |
    :: Start
    -> Question ->
    Answered.

    :: Question
    Pick one:
    + [Yes] ->->
    + [No] ->->
  play:
    - choose: 0
      output_contains: "Answered."

- name: tunnel-error-no-call
  description: Return without call is error
  input: |
    :: Start
    ->->
  expected:
    runtime_error: true

3. Create phase-4-validation/test-corpus/flow-control/once-tests.yaml:

- name: once-first-visit
  description: Once block shows on first visit
  input: |
    :: Start
    {once}
    First time!
    {/once}
    Always.
    + [Again] -> Start
  play:
    - output_contains: ["First time!", "Always."]
    - choose: 0
      output_contains: "Always."
      output_not_contains: "First time!"

- name: once-multiple-blocks
  description: Independent once blocks
  input: |
    :: Start
    {once}
    Block 1.
    {/once}
    {once}
    Block 2.
    {/once}
    + [Again] -> Start
  play:
    - output_contains: ["Block 1.", "Block 2."]
    - choose: 0
      output_not_contains: ["Block 1.", "Block 2."]
```

## Expected Output
~150 lines of test cases.

## Verification
```bash
cd ~/code/github.com/whisker-language-specification-1.0/phase-4-validation

# Count tests
grep -r "^- name:" test-corpus/flow-control/*.yaml | wc -l
# Expected: 15+
```

## Phase 2 Complete
This completes Phase 2: Flow Control with gather points, tunnels, inline conditionals, and once-only blocks.
