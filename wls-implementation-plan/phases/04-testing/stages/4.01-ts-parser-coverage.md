# Stage 4.01: TypeScript Parser Test Coverage

## Objective
Expand TypeScript parser tests to 98% coverage.

## Files to Create/Modify
- `packages/parser/src/**/*.test.ts`

## Prompt

```
Expand parser test coverage in whisker-editor-web:

1. Identify untested grammar rules:
pnpm --filter @writewhisker/parser test -- --coverage

2. Create tests for each untested area:

packages/parser/src/tests/
├── passage-names.test.ts    # Unicode, special chars, edge cases
├── choice-syntax.test.ts    # All choice variations
├── conditionals.test.ts     # Nested, complex expressions
├── data-structures.test.ts  # LIST, ARRAY, MAP parsing
├── functions.test.ts        # FUNCTION, NAMESPACE
├── whitespace.test.ts       # Indentation, blank lines
├── unicode.test.ts          # Non-ASCII in all positions
├── error-recovery.test.ts   # Malformed input handling
└── edge-cases.test.ts       # Boundary conditions

3. For each test file, cover:
- Valid input variations
- Invalid input (error cases)
- Boundary conditions
- Unicode handling
- Whitespace sensitivity

4. Target metrics:
- Line coverage: 98%
- Branch coverage: 95%
- All grammar rules tested
```

## Expected Output
~300 lines of additional tests.

## Verification
```bash
pnpm --filter @writewhisker/parser test -- --coverage
# Line coverage should be 98%+
```

## Next Stage
4.02-ts-validator-coverage.md
