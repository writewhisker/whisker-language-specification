# Stage 4.03: TypeScript Runtime Test Coverage

## Objective
Expand runtime tests to 90% coverage.

## Files to Create/Modify
- `packages/story-player/src/**/*.test.ts`

## Prompt

```
Expand runtime test coverage:

1. Core execution tests:

describe('StoryPlayer', () => {
  describe('passage navigation', () => {
    it('starts at Start passage', ...);
    it('navigates via choices', ...);
    it('navigates via links', ...);
    it('handles special targets', ...);
    it('errors on missing passage', ...);
  });

  describe('variable operations', () => {
    it('sets and gets variables', ...);
    it('handles temp variables', ...);
    it('interpolates in content', ...);
    it('evaluates expressions', ...);
  });

  describe('conditionals', () => {
    it('shows content when true', ...);
    it('hides content when false', ...);
    it('handles elif chains', ...);
    it('handles nested conditionals', ...);
  });

  describe('save/load', () => {
    it('saves complete state', ...);
    it('restores from save', ...);
    it('handles save format changes', ...);
  });
});

2. Flow control tests (from Phase 2):
- Gather points
- Tunnels
- Once-only blocks
- Inline conditionals

3. Edge cases:
- Empty passages
- Self-referential links
- Deep nesting
- Large stories

4. Performance tests:
- 1000+ passages
- 10000+ variable operations
- Rapid save/load cycles
```

## Expected Output
~300 lines of additional tests.

## Verification
```bash
pnpm --filter @writewhisker/story-player test -- --coverage
```

## Next Stage
4.04-lua-coverage.md
