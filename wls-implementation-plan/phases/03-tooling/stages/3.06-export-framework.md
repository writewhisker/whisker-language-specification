# Stage 3.06: Export Framework

## Objective
Create the extensible export framework.

## Files to Create
- `packages/export/src/types.ts`
- `packages/export/src/ExportManager.ts`
- `packages/export/src/index.ts`
- `packages/export/package.json`

## Prompt

```
Create the export package in whisker-editor-web:

1. Create packages/export/package.json:

{
  "name": "@writewhisker/export",
  "version": "1.0.0",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "build": "vite build",
    "test": "vitest"
  },
  "dependencies": {
    "@writewhisker/story-models": "workspace:*",
    "@writewhisker/story-player": "workspace:*"
  }
}

2. Create packages/export/src/types.ts:

import type { Story } from '@writewhisker/story-models';

export interface ExportResult {
  content: string | Buffer;
  filename: string;
  mimeType: string;
  additionalFiles?: ExportFile[];
}

export interface ExportFile {
  path: string;
  content: string | Buffer;
  mimeType: string;
}

export interface ExportOptions {
  title?: string;
  author?: string;
  theme?: string;
  minify?: boolean;
  embedAssets?: boolean;
  customCss?: string;
  customJs?: string;
}

export interface Exporter {
  name: string;
  extension: string;
  mimeType: string;

  export(story: Story, options?: ExportOptions): Promise<ExportResult>;
}

3. Create packages/export/src/ExportManager.ts:

import type { Exporter, ExportResult, ExportOptions } from './types';
import type { Story } from '@writewhisker/story-models';

export class ExportManager {
  private exporters: Map<string, Exporter> = new Map();

  register(exporter: Exporter): void {
    this.exporters.set(exporter.name, exporter);
  }

  getExporter(name: string): Exporter | undefined {
    return this.exporters.get(name);
  }

  async export(
    story: Story,
    format: string,
    options?: ExportOptions
  ): Promise<ExportResult> {
    const exporter = this.exporters.get(format);
    if (!exporter) {
      throw new Error(\`Unknown export format: \${format}\`);
    }
    return exporter.export(story, options);
  }

  listFormats(): string[] {
    return Array.from(this.exporters.keys());
  }
}

4. Create packages/export/src/index.ts:

export * from './types';
export { ExportManager } from './ExportManager';
```

## Expected Output
~120 lines across 4 files.

## Verification
```bash
cd ~/code/github.com/writewhisker/whisker-editor-web

pnpm --filter @writewhisker/export build
pnpm --filter @writewhisker/export typecheck
```

## Next Stage
3.07-html-exporter.md
