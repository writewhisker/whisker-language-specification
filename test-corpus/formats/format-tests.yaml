# WLS File Format Tests
# Category: formats
# Count: 15 tests

tests:
  # ============================================
  # TEXT FORMAT (.ws) (8 tests)
  # ============================================

  - name: format-text-minimal
    description: Minimal valid .ws file
    input: |
      :: Start
      Hello.
    expected:
      passages: 1
      valid: true

  - name: format-text-header
    description: Story header directives
    input: |
      @title: Test Story
      @author: Test Author
      @version: 1.0.0
      @ifid: 550e8400-e29b-41d4-a716-446655440000

      :: Start
      Content.
    expected:
      metadata:
        title: "Test Story"
        author: "Test Author"
        version: "1.0.0"
      valid: true

  - name: format-text-vars-block
    description: Variables block
    input: |
      @vars
        gold: 100
        name: "Hero"
        active: true

      :: Start
      $name has $gold gold.
    expected:
      variables:
        gold: 100
        name: "Hero"
        active: true
      valid: true

  - name: format-text-passage-directives
    description: Passage directives
    input: |
      :: Start
      @tags: chapter1, intro
      @color: #ff0000
      @notes: Opening scene

      Content here.
    expected:
      passage_tags: ["chapter1", "intro"]
      valid: true

  - name: format-text-lifecycle-scripts
    description: Passage lifecycle scripts
    input: |
      :: Start
      @onEnter: whisker.state.set("entered", true)
      @onExit: whisker.state.set("exited", true)

      Content.
    expected:
      valid: true

  - name: format-text-utf8
    description: UTF-8 content
    input: |
      :: Start
      Hello, ä¸–ç•Œ! ÐŸÑ€Ð¸Ð²ÐµÑ‚! ðŸŽ®
    expected:
      valid: true

  - name: format-text-start-directive
    description: Custom start passage
    input: |
      @start: Intro

      :: Intro
      This is the intro.

      :: Start
      Not the start.
    expected:
      start_passage: "Intro"
      valid: true

  - name: format-text-empty-file
    description: Empty file (valid syntax, no passages)
    input: ""
    expected:
      valid: true
      passages: 0
    note: Empty file is valid syntax; semantic validation may require passages

  # ============================================
  # JSON FORMAT (7 tests)
  # ============================================

  - name: format-json-minimal
    description: Minimal valid JSON
    input_json:
      format: whisker
      version: "2.1"
      wls: "1.0"
      metadata:
        title: Test
      passages:
        - id: Start
          content: Hello.
    expected:
      valid: true

  - name: format-json-full
    description: Full JSON structure
    input_json:
      format: whisker
      version: "2.1"
      wls: "1.0"
      metadata:
        title: Full Test
        author: Test Author
        version: "1.0.0"
        ifid: "550e8400-e29b-41d4-a716-446655440000"
        start: Start
      settings:
        debug: false
      variables:
        gold:
          type: number
          value: 100
      passages:
        - id: Start
          content: Content.
          tags: ["test"]
          metadata:
            color: "#ff0000"
          scripts:
            onEnter: null
            onExit: null
          choices:
            - type: once
              text: Continue
              target: END
      assets: []
    expected:
      valid: true

  - name: format-json-missing-format
    description: Missing format field (JSON format test - skipped for text parsers)
    input_json:
      version: "2.1"
      wls: "1.0"
      metadata: {}
      passages: []
    expected:
      valid: true
    note: JSON format tests use input_json; text parsers get empty input (valid)
    json_only: true

  - name: format-json-invalid-format
    description: Invalid format value (JSON format test - skipped for text parsers)
    input_json:
      format: twine
      version: "2.1"
      wls: "1.0"
      metadata: {}
      passages: []
    expected:
      valid: true
    note: JSON format tests use input_json; text parsers get empty input (valid)
    json_only: true

  - name: format-json-choice-object
    description: Choice object structure
    input_json:
      format: whisker
      version: "2.1"
      wls: "1.0"
      metadata: {}
      passages:
        - id: Start
          content: Content.
          choices:
            - type: once
              condition: "$gold >= 50"
              text: "Buy item"
              action: "$gold -= 50"
              target: Shop
        - id: Shop
          content: Shop content.
    expected:
      valid: true

  - name: format-json-variable-types
    description: Variable type validation
    input_json:
      format: whisker
      version: "2.1"
      wls: "1.0"
      metadata: {}
      variables:
        num:
          type: number
          value: 42
        str:
          type: string
          value: "hello"
        bool:
          type: boolean
          value: true
      passages:
        - id: Start
          content: Test.
    expected:
      valid: true

  - name: format-json-type-mismatch
    description: Variable type/value mismatch (JSON format test)
    input_json:
      format: whisker
      version: "2.1"
      wls: "1.0"
      metadata: {}
      variables:
        num:
          type: number
          value: "not a number"
      passages:
        - id: Start
          content: Test.
    expected:
      valid: true
    note: JSON format tests use input_json; text parsers get empty input (valid)
    json_only: true
